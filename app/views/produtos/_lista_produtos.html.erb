<div class="container">
  <% if produtos.first.present? %>
    <p class="alinhado-centro margin-top-10">Última atualização
      em: <%= produtos.first.created_at.to_time.getlocal.strftime("%d/%m/%Y %H:%M") %></p>
  <% end %>
  <div class="row">
    <% produtos.each do |produto| %>
      <div class="col-xs-12 col-sm-6 col-md-4 alinhado-centro padding-15">
        <div class="thumbnail product-box cor-padrao borda" data-produto="<%= produto.descricao %>">
          <img src="<%= produto.link_imagem %>" width="150px"/>
          <div class="caption centralizar">
            <p class="descricao-produto" title="<%= produto.descricao %>"><%= produto.descricao %></p>
            <strong><p class="preco-produto">Preço: <%= number_to_currency((produto.preco).to_d, unit: "R$ ", separator: ",") %></p></strong>
            <p> Mercado: <%= produto.codigo_mercado == 1 ? 'Brasão' : 'Moura' %>   </p>
            <p><a href="<%= produto.link_endereco %>" target="_blank">Ver produto
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-up-right-square-fill" viewBox="0 0 16 16">
                <path d="M14 0a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h12zM5.904 10.803 10 6.707v2.768a.5.5 0 0 0 1 0V5.5a.5.5 0 0 0-.5-.5H6.525a.5.5 0 1 0 0 1h2.768l-4.096 4.096a.5.5 0 0 0 .707.707z"/>
              </svg>
            </a></p>
            <p><a class="historico" data-produto="<%= produto.descricao %>">Ver Histórico
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clock-history" viewBox="0 0 16 16">
                <path d="M8.515 1.019A7 7 0 0 0 8 1V0a8 8 0 0 1 .589.022l-.074.997zm2.004.45a7.003 7.003 0 0 0-.985-.299l.219-.976c.383.086.76.2 1.126.342l-.36.933zm1.37.71a7.01 7.01 0 0 0-.439-.27l.493-.87a8.025 8.025 0 0 1 .979.654l-.615.789a6.996 6.996 0 0 0-.418-.302zm1.834 1.79a6.99 6.99 0 0 0-.653-.796l.724-.69c.27.285.52.59.747.91l-.818.576zm.744 1.352a7.08 7.08 0 0 0-.214-.468l.893-.45a7.976 7.976 0 0 1 .45 1.088l-.95.313a7.023 7.023 0 0 0-.179-.483zm.53 2.507a6.991 6.991 0 0 0-.1-1.025l.985-.17c.067.386.106.778.116 1.17l-1 .025zm-.131 1.538c.033-.17.06-.339.081-.51l.993.123a7.957 7.957 0 0 1-.23 1.155l-.964-.267c.046-.165.086-.332.12-.501zm-.952 2.379c.184-.29.346-.594.486-.908l.914.405c-.16.36-.345.706-.555 1.038l-.845-.535zm-.964 1.205c.122-.122.239-.248.35-.378l.758.653a8.073 8.073 0 0 1-.401.432l-.707-.707z"/>
                <path d="M8 1a7 7 0 1 0 4.95 11.95l.707.707A8.001 8.001 0 1 1 8 0v1z"/>
                <path d="M7.5 3a.5.5 0 0 1 .5.5v5.21l3.248 1.856a.5.5 0 0 1-.496.868l-3.5-2A.5.5 0 0 1 7 9V3.5a.5.5 0 0 1 .5-.5z"/>
              </svg>
            </a></p>
            <button type="button" class="btn btn-success adiciona-carrinho">Adicionar no Carrinho</button>
            <button type="button" class="btn btn-danger remove-carrinho hide">Remover no Carrinho</button>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>
<div class="rodape">
  <%= will_paginate @produtos, renderer: BootstrapPagination::Rails, params: {controller: 'produtos', action: 'index'} %>
</div>
<script>
    $('.thumbnail').each(function () {
        var produtos = JSON.parse(localStorage.getItem('produtos'));
        if (produtos) {
            $(".badge-pill").text(produtos.length);
            if (produtos.includes($(this).data('produto'))) {
                $(this).find('.remove-carrinho').removeClass('hide');
                $(this).find('.adiciona-carrinho').addClass('hide');
            }
        }
    });
</script>